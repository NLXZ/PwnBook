# SMB

## Enumeration

Service version detection and default nmap scripts

```bash
nmap -p139,445 -sCV <target>
```

Perform nmap enumeration scripts

```bash
nmap -p 139,445 --script "smb-enum-*" <target>
```

Full system enumeration with `enum4linux`

```bash
enum4linux -a [-u '<username>' -p '<password>'] <target>
```

### Shares Enumeration

{% hint style="info" %}
On windows systems you may need to escape backlashes: `\\\\<target>\\<share>`
{% endhint %}

```bash
# null session
smbclient -N -L //<target>
# authenticated
smbclient -U 'username[%password]' -L //<target>
# conect to a share
smbclient [-U 'username[%password]'] //<target>/<share>
```

```bash
# null session
smbmap -H <target>
# authenticated
smbmap -u "username" -p "password" -H <target>
# recursive/non-recursive listing
smbmap [-u "username" -p "password"] -R/-r <share> -H <target>
```

```bash
# null session
crackmapexec smb <IP> -u '' -p '' --shares
# authenticated
crackmapexec smb <IP> -u 'username' -p 'password' --shares
```

```bash
nmap -p 139,445 --script "smb-enum-shares" <target>
```

## References

[https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb)
